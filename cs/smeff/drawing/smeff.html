<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smeff's Beads</title>
<link rel="shortcut icon" href="../img/smeff.png" type="image/x-icon">
<style>
:root{
  --stone1:#7c3f2c;
  --stone2:#c47f3e;
  --stone3:#4e6b3a;
  --stone4:#b14e6a;
  --stone5:#f4d03f;
  --stone6:#1f618d;
  --stone7:#9b59b6;
  --sand:#f0e0c2;
}
html,body{
  margin:0;padding:0;height:100%;display:flex;flex-direction:column;align-items:center;
  font-family:'Papyrus',serif;background:var(--sand);
}
header{text-align:center;margin:10px;}
header img.logo{height:80px;width:auto;}
.controls{margin:10px;}
button{padding:8px 12px;margin:0 4px;border-radius:8px;border:none;background:#6a4324;color:white;cursor:pointer;font-weight:bold;}
#palette{margin:10px;}
.color-swatch{width:32px;height:32px;border-radius:50%;display:inline-block;margin:0 4px;cursor:pointer;border:2px solid #3b2a1a;}
canvas{border:2px solid #b08a5a;border-radius:12px;background:#f9eac9;}
</style>
</head>
<body>

<header>
  <img src="../img/smeff.png" class="logo" alt="Smeff">
  <h1>Smeff's Beads</h1>
</header>

<div class="controls">
  <button id="undoBtn">Undo</button>
  <button id="redoBtn">Redo</button>
  <button id="clearBtn">Clear</button>
  <button id="stampBtn">Stamp Smeff</button>
  <button id="saveBtn">Save PNG</button>
</div>

<div id="palette">
  <div class="color-swatch" style="background:var(--stone1)" data-color="var(--stone1)"></div>
  <div class="color-swatch" style="background:var(--stone2)" data-color="var(--stone2)"></div>
  <div class="color-swatch" style="background:var(--stone3)" data-color="var(--stone3)"></div>
  <div class="color-swatch" style="background:var(--stone4)" data-color="var(--stone4)"></div>
  <div class="color-swatch" style="background:var(--stone5)" data-color="var(--stone5)"></div>
  <div class="color-swatch" style="background:var(--stone6)" data-color="var(--stone6)"></div>
  <div class="color-swatch" style="background:var(--stone7)" data-color="var(--stone7)"></div>
</div>

<canvas id="canvas" width="600" height="600"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const gridSize = 12;
const cellSize = canvas.width/gridSize;
let currentColor='var(--stone1)';
let stampMode=false;

let history=[];
let redoStack=[];

function fillSand(){
  ctx.fillStyle=getComputedStyle(document.body).backgroundColor;
  ctx.fillRect(0,0,canvas.width,canvas.height);
}
fillSand();

document.querySelectorAll('.color-swatch').forEach(s=>{
  s.addEventListener('click',()=>{ 
    currentColor = getComputedStyle(s).backgroundColor;
    stampMode=false;
  });
});

document.getElementById('clearBtn').addEventListener('click',()=>{
  saveState();
  fillSand();
  redoStack=[];
});
document.getElementById('stampBtn').addEventListener('click',()=>{ stampMode=true; });
document.getElementById('saveBtn').addEventListener('click',()=>{
  const link=document.createElement('a');
  link.download='smeff_sand_beads_mosaic.png';
  link.href=canvas.toDataURL();
  link.click();
});
document.getElementById('undoBtn').addEventListener('click',undo);
document.getElementById('redoBtn').addEventListener('click',redo);

function saveState(){
  const img = ctx.getImageData(0,0,canvas.width,canvas.height);
  history.push(img);
  if(history.length>50) history.shift();
}
function undo(){
  if(history.length>0){
    redoStack.push(ctx.getImageData(0,0,canvas.width,canvas.height));
    const prev = history.pop();
    ctx.putImageData(prev,0,0);
  }
}
function redo(){
  if(redoStack.length>0){
    history.push(ctx.getImageData(0,0,canvas.width,canvas.height));
    const next = redoStack.pop();
    ctx.putImageData(next,0,0);
  }
}

function drawBead(x,y,color){
  const cx = x*cellSize + cellSize/2;
  const cy = y*cellSize + cellSize/2;
  const radius = cellSize/2 -2;

  ctx.beginPath();
  ctx.arc(cx+2,cy+2,radius,0,Math.PI*2);
  const shadowGrad = ctx.createRadialGradient(cx+2,cy+2,2,cx+2,cy+2,radius);
  shadowGrad.addColorStop(0,'rgba(0,0,0,0.3)');
  shadowGrad.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle=shadowGrad;
  ctx.fill();

  ctx.beginPath();
  ctx.arc(cx,cy,radius,0,Math.PI*2);
  const grad = ctx.createRadialGradient(cx-3,cy-3,2,cx,cy,radius);
  grad.addColorStop(0,'#fff');
  grad.addColorStop(1,color);
  ctx.fillStyle=grad;
  ctx.fill();
  ctx.strokeStyle="#a78c65";
  ctx.stroke();
}

canvas.addEventListener('click',e=>{
  const rect=canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX-rect.left)/cellSize);
  const y = Math.floor((e.clientY-rect.top)/cellSize);
  saveState();
  redoStack=[];
  if(stampMode){
    const img = new Image();
    img.src='../img/smeff.png';
    img.onload = ()=>{ ctx.drawImage(img,x*cellSize,y*cellSize,cellSize*2,cellSize*2); }
  } else {
    drawBead(x,y,currentColor);
  }
});
</script>
</body>
</html>
